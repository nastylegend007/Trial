<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  </head>
  <body>
    <section class="hero is-primary is-bold">
      <div class="hero-body">
        <div class="container">
          <h1 class="title">Data Entry Form</h1>
        </div>
      </div>
    </section>
    <form id="form" class="container m-4 pl-4" method="POST">
      <div class="field">
        <label class="label">Client Name</label>
        <div class="control">
          <input
            class="input"
            type="text"
            placeholder="Your Client Name"
            name="Client Name"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Last Name</label>
        <div class="control">
          <input
            class="input"
            type="text"
            placeholder="Your Last Name"
            name="Last Name"
          />
        </div>
        <div class="field">
        <label class="label">Phone Number</label>
        <div class="control">
          <input
            class="input"
            type="text"
            placeholder="Your numbere"
            name="Phone Number"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Email</label>
        <div class="control">
          <input
            class="input"
            type="email"
            placeholder="Your Email"
            name="Email"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Password</label>
        <div class="control">
          <input
            class="input"
            type="password"
            placeholder="Your Password"
            name="Password"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Date of Birth</label>
        <div class="control">
          <input
            class="input"
            type="date"
            placeholder="Your Date of Birth"
            name="DOB"
          />
        </div>
      </div>

      <div class="field">
        <label class="label">Gender</label>
        <div class="control">
          <label class="radio">
            <input type="radio" name="Gender" value="male" /> Male
          </label>
          <label class="radio">
            <input type="radio" name="Gender" value="female" /> Female
          </label>
        </div>
      </div>

      <div class="field">
        <label class="label">Agree to Terms</label>
        <div class="control">
          <label class="checkbox">
            <input type="checkbox" name="Agree To Terms" value="yes" /> I agree
            to the terms and conditions
          </label>
        </div>
      </div>

      <div class="field">
        <label class="label">Additional Information</label>
        <div class="control">
          <textarea
            class="textarea"
            placeholder="Any additional information"
            name="Notes"
          ></textarea>
        </div>
      </div>

      <div class="field is-grouped">
        <div class="control">
          <button class="button is-primary" type="submit" id="submit-button">
            Sign Up
          </button>
        </div>
        <div class="control">
          <button class="button is-danger">Cancel</button>
        </div>
      </div>
    </form>
    <div
      id="message"
      style="
        display: none;
        margin: 20px;
        font-weight: bold;
        color: green;
        padding: 8px;
        background-color: beige;
        border-radius: 4px;
        border-color: aquamarine;
      "
    ></div>
<div id="whatsapp-button-container" style="display: none; margin-top: 20px;">
  <button id="whatsapp-button" class="button is-success">Click to WhatsApp</button>
</div>

    <script>
  document.getElementById("form").addEventListener("submit", function (e) {
    e.preventDefault(); // Prevent the default form submission
  if (this.submitting) return; // Prevent multiple submissions
  this.submitting = true;
  document.getElementById("message").textContent = "Submitting..";
  document.getElementById("message").style.display = "block";
  document.getElementById("submit-button").disabled = true;

    // Create PDF invoice using jsPDF
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.text("Invoice", 14, 10);
  doc.text(`Client Name: ${formData.get("Client Name")}`, 14, 20);
  doc.text(`Last Name: ${formData.get("Last Name")}`, 14, 30);
  doc.text(`Phone: ${phoneNumber}`, 14, 40);
  doc.text(`Email: ${formData.get("Email")}`, 14, 50);
  doc.text(`Item 1: $${item1} x ${quantity1}`, 14, 60);
  doc.text(`Item 2: $${item2} x ${quantity2}`, 14, 70);
  doc.text(`Total Amount: $${totalAmount}`, 14, 80);

  // Save the PDF automatically
  doc.save('invoice.pdf');

  // Collect the form data
  var formData = new FormData(this);

  // Add ordered items and total amount to the form data
  var item1 = document.getElementById("item1").value;
  var quantity1 = document.getElementById("quantity1").value;
  var item2 = document.getElementById("item2").value;
  var quantity2 = document.getElementById("quantity2").value;
  var totalAmount = document.getElementById("total").textContent.slice(1); // Remove '$' symbol
  var phoneNumber = formData.get('Phone Number'); // Retrieve phone number

  formData.append("Item1", `Item 1: $${item1} x ${quantity1}`);
  formData.append("Item2", `Item 2: $${item2} x ${quantity2}`);
  formData.append("Total Amount", totalAmount);

  var keyValuePairs = [];
  for (var pair of formData.entries()) {
    keyValuePairs.push(pair[0] + "=" + pair[1]);
  }

  var formDataString = keyValuePairs.join("&");

  // Send a POST request to your Google Apps Script
  fetch(
    "https://script.google.com/macros/s/AKfycbxNLDKTW1PTT2OfLNEQ0QoEDwmv4c5TJKb70J3h-NrYAWeW7WzTtMX1OMLw4DCU3B_e_A/exec",
    {
      redirect: "follow",
      method: "POST",
      body: formDataString,
      headers: {
        "Content-Type": "text/plain;charset=utf-8",
      },
    }
  )
    .then(function (response) {
      // Check if the request was successful
      if (response) {
        return response; // Assuming your script returns JSON response
      } else {
        throw new Error("Failed to submit the form.");
      }
    })
    .then(function (data) {
      // Display a success message
      document.getElementById("message").textContent =
        "Data submitted successfully!";
      document.getElementById("message").style.display = "block";
      document.getElementById("message").style.backgroundColor = "green";
      document.getElementById("message").style.color = "beige";
      document.getElementById("submit-button").disabled = false;
      document.getElementById("form").reset();

      // Show the WhatsApp button with the phone number
      var whatsappButton = document.getElementById("whatsapp-button");
      var whatsappLink = "https://wa.me/+91" + phoneNumber; // Concatenate with +91 and phone number
      whatsappButton.onclick = function () {
        window.open(whatsappLink, "_blank"); // Open the WhatsApp link in a new tab
      };

      // Display the WhatsApp button
      document.getElementById("whatsapp-button-container").style.display = "block";

      setTimeout(function () {
        document.getElementById("message").textContent = "";
        document.getElementById("message").style.display = "none";
      }, 2600);
    })
    .catch(function (error) {
      // Handle errors, you can display an error message here
      console.error(error);
      document.getElementById("message").textContent =
        "An error occurred while submitting the form.";
      document.getElementById("message").style.display = "block";
    });
});

</script>

    <div class="order-section">
        <h1>Order Your Meal</h1>

        <div class="item-row">
            <label for="item1">Select Item 1:</label>
            <select id="item1" onchange="updateTotal()">
                <option value="0">-- Select an Item --</option>
                <option value="100">Grilled Chicken - $100</option>
                <option value="50">Salad Bowl - $50</option>
                <option value="30">Fruit Smoothie - $30</option>
                <option value="20">Protein Bar - $20</option>
            </select>

            <label for="quantity1">Select Quantity:</label>
            <select id="quantity1" onchange="updateTotal()">
                <option value="0">-- Select Quantity --</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>

        <div class="item-row">
            <label for="item2">Select Item 2:</label>
            <select id="item2" onchange="updateTotal()">
                <option value="0">-- Select an Item --</option>
                <option value="100">Grilled Chicken - $100</option>
                <option value="50">Salad Bowl - $50</option>
                <option value="30">Fruit Smoothie - $30</option>
                <option value="20">Protein Bar - $20</option>
            </select>

            <label for="quantity2">Select Quantity:</label>
            <select id="quantity2" onchange="updateTotal()">
                <option value="0">-- Select Quantity --</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>

        <p>Total Amount: <span id="total">$0</span></p>
    </div>

    <script>
        function updateTotal() {
            const item1Price = parseFloat(document.getElementById("item1").value);
            const quantity1 = parseInt(document.getElementById("quantity1").value);

            const item2Price = parseFloat(document.getElementById("item2").value);
            const quantity2 = parseInt(document.getElementById("quantity2").value);

            let totalAmount = 0;

            if (!isNaN(item1Price) && !isNaN(quantity1)) {
                totalAmount += item1Price * quantity1;
            }

            if (!isNaN(item2Price) && !isNaN(quantity2)) {
                totalAmount += item2Price * quantity2;
            }

            document.getElementById("total").textContent = `$${totalAmount}`;
        }
    </script>
  </body>
</html>
